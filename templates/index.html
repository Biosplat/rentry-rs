{% extends "base.html" %}

{% block title %}{{title}}{% endblock %}

{% block head %}
{% call super() %}
<script src="https://cdn.tailwindcss.com"></script>
<style>
    body {
        background-color: #121212;
        color: #E0E0E0;
    }
    textarea {
        background-color: #222222;
        color: #E0E0E0;
        border-color: #444444;
    }
    h1 {
        color: #BB86FC;
    }
    p {
        color: #E0E0E0;
    }
    button {
        background-color: #BB86FC;
        color: #121212;
    }
    button:hover {
        background-color: #A167E6;
    }
    iframe {
        border: none;
        width: 100%;
        height: 100%;
    }
</style>
{% endblock %}

{% block content %}
<div class="container mx-auto py-8 px-4">
    <h1 class="text-4xl font-bold mb-4">Welcome to Rentry</h1>
    <p class="text-xl mb-8">Your simple, dark-themed markdown pastebin. Share and store markdown documents with ease.</p>
    <div class="flex">
        <div class="w-1/2 pr-4">
            <textarea id="pasteContent" class="w-full h-96 p-4 rounded-md" placeholder="Paste your markdown content here..."></textarea>
            <button id="createPasteBtn" class="px-4 py-2 rounded-md mt-4" onclick="createPaste()">Create New Paste</button>
        </div>
        <div class="w-1/2 pl-4">
            <iframe id="markdownPreview" class="bg-gray-800 p-4 rounded-md h-96"></iframe>
        </div>
    </div>
</div>
<script>
    let debounceTimer;
    const debounceDelay = 500; // Adjust the delay as needed

    document.getElementById('pasteContent').addEventListener('input', function() {
        clearTimeout(debounceTimer);
        debounceTimer = setTimeout(renderMarkdown, debounceDelay);
    });

    async function renderMarkdown() {
        const content = document.getElementById('pasteContent').value;
        const response = await fetch('/api/markdown/render', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ content })
        });
        const data = await response.json();
        const iframe = document.getElementById('markdownPreview');
        iframe.srcdoc = `
            <html>
                <head>
                    <link rel="stylesheet" href="/static/dark.css">
                </head>
                <body>
                    <div id="markdownPreview">${data.html}</div>
                </body>
            </html>
        `;
    }

    async function createPaste() {
        const content = document.getElementById('pasteContent').value;
        const response = await fetch('/api/pastes', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ content })
        });
        const data = await response.json();
        window.location.href = `/p/${data.slug}?edit_code=${data.edit_code}`;
    }
</script>
{% endblock %}